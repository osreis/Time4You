
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>

    <meta content="IE=EmulateIE7" http-equiv="X-UA-Compatible">
    <title>Time4You - Login</title>

	<!-- ADD STYLESHEETS REFERENCES -->

	 <%= stylesheet_link_tag    "application", :media => "all" %>
	  <%= javascript_include_tag "application" %>
	 <%= javascript_include_tag :defaults, "rails.validations" %>
	  <%= csrf_meta_tags %>

	
</head>


<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="#">Time4You</a>
      <div class="nav-collapse">
        <ul class="nav">
        </ul>
      </div>
	  
    </div>
	
	
  </div>
</div>

<body>	    

<div class="container">
		<div class="row">
			<div id="login" style="border:1px solid #E5E5E5; padding:20px 25px 15px; border-radius:20; background:#F1F1F1; width:230px; margin-top:60; margin-left:auto; margin-right:auto">
				<h2>Login</h2>
				<div id="flash_notice_error"></div>
					<% flash.each do |name, msg| %>
						<%= content_tag :div, msg, :id => "flash_#{name}" %>
					<% end %> 
				<%= form_tag sessions_path do %>
				<div class="field" style="font-size:15">
					</br><b>Login</b></br>
					<%= text_field_tag :email, params[:login], :class => "email_password", :id => "email" , :style => "height:30"%></br></br>
				</div>
				<div class="field" style="font-size:15">
					<b>Senha</b></br>
					<%= password_field_tag :password, params[:password], :class => "email_password", :id => "password", :style => "height:30" %>  
				</div>
				<div class="action" align="right">
					<%= submit_tag "Entrar", :class=>"btn btn-success" %>
				</div>
				<% end %>
			</div>
		</div>
	</div>

	<div id="loading" style="display:none">  
	<%= t(:session_entering) %> 
	<img src="/assets/loading/ajax-loader.gif" alt="loading.." />  
	</div>
</body>	


<script>
			   
  $(document).ready(function(){
	
		$("#flash_notice_error").hide();
		
               var lojas = [];


               $("#listaLojas option").each(function(){
                 lojas.push($(this).text());
               });


                       $( "#tag" ).autocomplete({
                               source: lojas
                       });
	
  });

 /* funcao que recebe a resposta do metodo rails de validacao de senha*/
  function check_ajaxAjax(data)
  {
		if(data == false){
			$("#flash_notice_error").show();
			$("#flash_notice_error").html("login ou senha incorretos");
		 	$("#loading").hide(); 
		}
		else {
			location.href="home?login=true";
		}
  }

/* depois de submeter, ativa-se a loading bar. Antes de submeter verifica se o formulario eh valido*/
$(window).submit(function(){ 
	$("#flash_notice_success").hide();
	if ($("#password").val().length == 0){
		$("#flash_notice_error").show();
		$("#flash_notice_error").html("digite uma senha");
		return false;
	}
	else if ($("#email").val().length == 0){
		$("#flash_notice_error").show();
		$("#flash_notice_error").html("digite um email");
		return false;
	}
	else {
		$("#loading").show(); 
		$("#flash_notice_error").hide();
		$.getJSON ("sessions/check_ajax?password=" + $("#password").val() +"&login=" + $("#email").val(), check_ajaxAjax);
		return false;
	}
	
			  
}) 

 
</script>
